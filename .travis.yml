language: node_js
nvm:
- 10.2.1
env:
- NODE_ENV=test
global:
- PGPORT=5433
- CI_DB_USERNAME='postgres'
- CI_DB_PASSWORD=null
- CI_DB_NAME='travis_ci_test'
- CI_DB_PORT=5433
deploy:
  provider: heroku
  api_key:
    secure: mvclBVdCBLTFm50jJB+BQPgVA5r1RwcAWgSu7yE2MJ/5YV+kByNlmUbvtVq/5iIKjRZYjr+pHnNSMtp/sjhTIEsIYcR+EBMqODN+hHaTon0vuHqPb+AjAKZem2OO5AY26FDj8y4x3opeLwv8eAb9+2+o4mrs1EEOnjMM277m/kvEpk1U9VeVBDrK57eBg9gFUGeCjXvkWkltVE29jcypp0etrE/EyICf4nXQpxazEViu9WbjdnbPbu0bYz9znUHjShARz886HoioMhSSetUVKG6fL0K708ht4BFrFoRR9i/Z+ydvxr/2OzG+wkDwPutLcZwL/zqaJVW3GpXzidUTdh1sWw/HrzRqxz25NG43sKGx8FmJmVl7SrIuL5AWtN62Hihg6tA+TUboMrrnUFKBz47CVbT53m8qbOqltXnFRhQ0rX7sygCCAEhZGyoimprZLCZRv+HYV+fVK3cvU+FDgGNuGhPM7EcUjkQGYeCT9jcqnt/m3VnOO9Pm4Q77wv9p+92QmdTyIK9r6CIQ9whv1p7eZjsdOEDbLwCxBLOUfdlCKN5rIyvsQ8Ns5n/MiP/uYt5k4kc6URMKnNSSl2IQF6UtX+FacV8cp9lyQNo2+QgI9JzqysR+53q2hUuZhLz6sJEXad95b44aabtEHZ8goAtiNmWhf2k2OxNQPp52SZQ=
  app: shrouded-depths-22477
  on:
    repo: thejonroberts/booking-node-api
    branch: master
install: npm install
services:
- postgresql
before_script:
- npm install -g sequelize-cli
- psql -c 'create database travis_ci_test;' -U postgres
- sequelize db:migrate:undo:all
- sequelize db:migrate
- sequelize db:seed:all
script: npm test
after_success:
- test $TRAVIS_BRANCH = "master" && test $TRAVIS_PULL_REQUEST = "false" && npm run coverage
